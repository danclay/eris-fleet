<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>eris-fleet - v1.0.2</title><meta name="description" content="Documentation for eris-fleet - v1.0.2"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">eris-fleet - v1.0.2</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>eris-fleet - v1.0.2 </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography"><p><strong>⚠️ This repo will no longer be updated since eris-fleet has been moved to a monorepo to make adaptation of it for the <a href="https://github.com/OceanicJS/Oceanic">Oceanic library</a> easier. This monorepo is  <a href="https://github.com/danclay/wumpus-navy">wumpus-navy</a>. For the latest version see the monorepo. Eris-fleet the package is not deprecated and the npm package will be updated under the same name as before. This repo is deprecated.</strong></p>
<p><strong>The documentation has moved as well: <a href="https://danclay.github.io/wumpus-navy/">https://danclay.github.io/wumpus-navy/</a></strong></p>
<div align="center">
  <p>
  <a href="https://github.com/abalabahaha/eris"><img src="https://img.shields.io/badge/Discord%20Library-Eris-blue?style=flat-square" alt="Discord Library" /></a>
    <a href="https://www.npmjs.com/package/eris-fleet"><img src="https://img.shields.io/npm/v/eris-fleet.svg?cacheSeconds=3600&style=flat-square&label=version&logo=npm" alt="NPM version" /></a>
    <a href="https://raw.githubusercontent.com/danclay/eris-fleet/master/LICENSE"><img alt="License" src="https://img.shields.io/npm/l/eris-fleet?style=flat-square">
    <a href="https://github.com/danclay/eris-fleet/actions/workflows/ci.yml"><img src="https://img.shields.io/github/workflow/status/danclay/eris-fleet/Node.js%20CI/master?style=flat-square&logo=github" alt="Node.js CI" /></a>
  </p>
  <p>
    <a href="https://www.npmjs.com/package/eris-fleet/"><img src="https://nodeico.herokuapp.com/eris-fleet.svg"></a>
  </p>
</div>


<a href="#documentation--eris" id="documentation--eris" style="color: inherit; text-decoration: none;">
  <h3><a href="https://danclay.github.io/eris-fleet/">Documentation</a> | <a href="https://github.com/abalabahaha/eris">Eris</a></h3>
</a>

<a href="#about-eris-fleet" id="about-eris-fleet" style="color: inherit; text-decoration: none;">
  <h1>About eris-fleet</h1>
</a>
<p>A spin-off of <a href="https://github.com/discordware/eris-sharder">eris-sharder</a> and <a href="https://github.com/brussell98/megane">megane</a> with services and configurable logging.</p>
<p>For detailed documentation check the <a href="https://danclay.github.io/eris-fleet/">docs</a>.</p>
<p>eris-fleet currently supports Eris v0.16.x.</p>

<a href="#highlighted-features" id="highlighted-features" style="color: inherit; text-decoration: none;">
  <h2>Highlighted Features:</h2>
</a>
<ul>
<li>Clustering across cores</li>
<li>Sharding</li>
<li>Recalculate shards with minimal downtime</li>
<li>Update a bot with minimal downtime using soft restarts</li>
<li>Customizable logging</li>
<li>Fetch data from across clusters easily</li>
<li>Services (non-eris workers)</li>
<li>IPC to communicate between clusters, other clusters, and services</li>
<li>Detailed stats collection</li>
<li>Soft cluster and service restarts where the old worker is killed after the new one is ready</li>
<li>Graceful shutdowns</li>
<li>Central request handler</li>
<li>Central data store</li>
<li>Can use a modified version of Eris</li>
<li>Concurrency support</li>
</ul>
<p>A very basic diagram:</p>
<p><img src="https://cdn.discordapp.com/attachments/866590047436144641/965161462479859742/Untitled_Diagram.drawio_1.png" alt="Basic diagram"></p>

<a href="#help" id="help" style="color: inherit; text-decoration: none;">
  <h2>Help</h2>
</a>
<p>If you still have questions, you can join the support server on Discord: <a href="https://discord.gg/tk2n3naJn3">Discord server</a></p>
<p><a href="https://discord.gg/tk2n3naJn3"><img src="https://discord.com/api/guilds/866589508392976384/widget.png?style=banner2" alt="Support server on Discord"></a></p>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h1>Installation</h1>
</a>
<p>Run <code>npm install eris-fleet</code> or with yarn: <code>yarn add eris-fleet</code>.</p>
<p>To use a less refined, but more up-to-date branch, use <code>npm install danclay/eris-fleet#dev</code> or <code>yarn add danclay/eris-fleet#dev</code>. <a href="https://github.com/danclay/eris-fleet/tree/dev">Documentation for the dev branch.</a></p>

<a href="#basics" id="basics" style="color: inherit; text-decoration: none;">
  <h1>Basics</h1>
</a>
<p>Some working examples are in <a href="https://github.com/danclay/eris-fleet/tree/master/test">test/</a>.</p>

<a href="#naming-conventions" id="naming-conventions" style="color: inherit; text-decoration: none;">
  <h2>Naming Conventions</h2>
</a>
<table>
<thead>
<tr>
<th>Term</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>&quot;fleet&quot;</td>
<td>All the components below</td>
</tr>
<tr>
<td>&quot;admiral&quot;</td>
<td>A single sharding manager</td>
</tr>
<tr>
<td>&quot;worker&quot;</td>
<td>A worker for node clustering</td>
</tr>
<tr>
<td>&quot;cluster&quot;</td>
<td>A worker containing Eris shards</td>
</tr>
<tr>
<td>&quot;service&quot;</td>
<td>A worker that does not contain Eris shards, but can interact with clusters</td>
</tr>
</tbody></table>

<a href="#get-started" id="get-started" style="color: inherit; text-decoration: none;">
  <h2>Get Started</h2>
</a>
<p>To get started, you will need at least 2 files:</p>
<ol>
<li>Your file which will create the fleet. This will be called &quot;index.js&quot; for now.</li>
<li>Your file containing your bot code. This will be called &quot;bot.js&quot; for now. This file will extend <code>BaseClusterWorker</code></li>
</ol>
<p>In the example below, the variable <code>options</code> is passed to the admiral. <a href="https://danclay.github.io/eris-fleet/interfaces/Options.html">Read the docs</a> for what options you can pass.</p>
<p>Here is an example of <code>index.js</code>:</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">isMaster</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;cluster&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">Fleet</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;eris-fleet&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">path</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;path&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">inspect</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;util&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;dotenv&#39;</span><span class="hl-1">).</span><span class="hl-3">config</span><span class="hl-1">();</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">options</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-5">path:</span><span class="hl-1"> </span><span class="hl-5">path</span><span class="hl-1">.</span><span class="hl-3">join</span><span class="hl-1">(</span><span class="hl-5">__dirname</span><span class="hl-1">, </span><span class="hl-4">&quot;./bot.js&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-5">token:</span><span class="hl-1"> </span><span class="hl-5">process</span><span class="hl-1">.</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">token</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">Admiral</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Fleet</span><span class="hl-1">(</span><span class="hl-5">options</span><span class="hl-1">);</span><br/><br/><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-5">isMaster</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// Code to only run for your master process</span><br/><span class="hl-1">    </span><span class="hl-5">Admiral</span><span class="hl-1">.</span><span class="hl-3">on</span><span class="hl-1">(</span><span class="hl-4">&#39;log&#39;</span><span class="hl-1">, </span><span class="hl-5">m</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">m</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><span class="hl-5">Admiral</span><span class="hl-1">.</span><span class="hl-3">on</span><span class="hl-1">(</span><span class="hl-4">&#39;debug&#39;</span><span class="hl-1">, </span><span class="hl-5">m</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-3">debug</span><span class="hl-1">(</span><span class="hl-5">m</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><span class="hl-5">Admiral</span><span class="hl-1">.</span><span class="hl-3">on</span><span class="hl-1">(</span><span class="hl-4">&#39;warn&#39;</span><span class="hl-1">, </span><span class="hl-5">m</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-3">warn</span><span class="hl-1">(</span><span class="hl-5">m</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><span class="hl-5">Admiral</span><span class="hl-1">.</span><span class="hl-3">on</span><span class="hl-1">(</span><span class="hl-4">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-5">m</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-3">error</span><span class="hl-1">(</span><span class="hl-3">inspect</span><span class="hl-1">(</span><span class="hl-5">m</span><span class="hl-1">)));</span><br/><br/><span class="hl-1">    </span><span class="hl-7">// Logs stats when they arrive</span><br/><span class="hl-1">    </span><span class="hl-5">Admiral</span><span class="hl-1">.</span><span class="hl-3">on</span><span class="hl-1">(</span><span class="hl-4">&#39;stats&#39;</span><span class="hl-1">, </span><span class="hl-5">m</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">m</span><span class="hl-1">));</span><br/><span class="hl-1">}</span>
</code></pre>
<p>This creates a new Admiral that will manage <code>bot.js</code> running in other processes. <a href="https://danclay.github.io/eris-fleet/classes/BaseClusterWorker.html">More details</a></p>
<p>The following is an example of <code>bot.js</code>. <a href="https://danclay.github.io/eris-fleet/classes/IPC.html">Read the IPC docs</a> for what you can access and do with clusters.</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">BaseClusterWorker</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;eris-fleet&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">module</span><span class="hl-1">.</span><span class="hl-8">exports</span><span class="hl-1"> = </span><span class="hl-0">class</span><span class="hl-1"> </span><span class="hl-8">BotWorker</span><span class="hl-1"> </span><span class="hl-0">extends</span><span class="hl-1"> </span><span class="hl-8">BaseClusterWorker</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">constructor</span><span class="hl-1">(</span><span class="hl-5">setup</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Do not delete this super.</span><br/><span class="hl-1">        </span><span class="hl-0">super</span><span class="hl-1">(</span><span class="hl-5">setup</span><span class="hl-1">);</span><br/><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">bot</span><span class="hl-1">.</span><span class="hl-3">on</span><span class="hl-1">(</span><span class="hl-4">&#39;messageCreate&#39;</span><span class="hl-1">, </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">handleMessage</span><span class="hl-1">.</span><span class="hl-3">bind</span><span class="hl-1">(</span><span class="hl-0">this</span><span class="hl-1">));</span><br/><br/><span class="hl-1">        </span><span class="hl-7">// Demonstration of the properties the cluster has (Keep reading for info on IPC):</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">ipc</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">workerID</span><span class="hl-1">); </span><span class="hl-7">// ID of the worker</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">ipc</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">clusterID</span><span class="hl-1">); </span><span class="hl-7">// The ID of the cluster</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-3">handleMessage</span><span class="hl-1">(</span><span class="hl-5">msg</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-5">msg</span><span class="hl-1">.</span><span class="hl-5">content</span><span class="hl-1"> === </span><span class="hl-4">&quot;!ping&quot;</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-5">msg</span><span class="hl-1">.</span><span class="hl-5">author</span><span class="hl-1">.</span><span class="hl-5">bot</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">bot</span><span class="hl-1">.</span><span class="hl-3">createMessage</span><span class="hl-1">(</span><span class="hl-5">msg</span><span class="hl-1">.</span><span class="hl-5">channel</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">, </span><span class="hl-4">&quot;Pong!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">handleCommand</span><span class="hl-1">(</span><span class="hl-5">dataSentInCommand</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Optional function to return data from this cluster when requested</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">&quot;hello!&quot;</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">shutdown</span><span class="hl-1">(</span><span class="hl-5">done</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Optional function to gracefully shutdown things if you need to.</span><br/><span class="hl-1">        </span><span class="hl-3">done</span><span class="hl-1">(); </span><span class="hl-7">// Use this function when you are done gracefully shutting down.</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code></pre>
<p><strong>Make sure your bot file extends BaseClusterWorker!</strong>
The bot above will respond with &quot;Pong!&quot; when it receives the command &quot;!ping&quot;.</p>

<a href="#services" id="services" style="color: inherit; text-decoration: none;">
  <h2>Services</h2>
</a>
<p>You can create services for your bot. Services are workers which do not interact directly with Eris. Services are useful for processing tasks, a central location to get the latest version of languages for your bot, custom statistics, and more! <a href="https://danclay.github.io/eris-fleet/classes/IPC.html">Read the IPC docs</a> for what you can access and do with services. <strong>Note that services always start before the clusters. Clusters will only start after all the services have started.</strong> <a href="https://danclay.github.io/eris-fleet/classes/BaseServiceWorker.html">More details</a></p>
<p>To add a service, add the following to the options you pass to the fleet:</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">options</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-7">// Your other options...</span><br/><span class="hl-1">    </span><span class="hl-5">services:</span><span class="hl-1"> [{</span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-4">&quot;myService&quot;</span><span class="hl-1">, </span><span class="hl-5">path:</span><span class="hl-1"> </span><span class="hl-5">path</span><span class="hl-1">.</span><span class="hl-3">join</span><span class="hl-1">(</span><span class="hl-5">__dirname</span><span class="hl-1">, </span><span class="hl-4">&quot;./service.js&quot;</span><span class="hl-1">)}]</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Add a new array element for each service you want to register. Make sure each service has a unique name or else the fleet will crash.</p>
<p>Here is an example of <code>service.js</code>:</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">BaseServiceWorker</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;eris-fleet&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">module</span><span class="hl-1">.</span><span class="hl-8">exports</span><span class="hl-1"> = </span><span class="hl-0">class</span><span class="hl-1"> </span><span class="hl-8">ServiceWorker</span><span class="hl-1"> </span><span class="hl-0">extends</span><span class="hl-1"> </span><span class="hl-8">BaseServiceWorker</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">constructor</span><span class="hl-1">(</span><span class="hl-5">setup</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Do not delete this super.</span><br/><span class="hl-1">        </span><span class="hl-0">super</span><span class="hl-1">(</span><span class="hl-5">setup</span><span class="hl-1">);</span><br/><br/><span class="hl-1">        </span><span class="hl-7">// Run this function when your service is ready for use. This MUST be run for the worker spawning to continue.</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">serviceReady</span><span class="hl-1">();</span><br/><br/><span class="hl-1">        </span><span class="hl-7">// Demonstration of the properties the service has (Keep reading for info on IPC):</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">ipc</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">workerID</span><span class="hl-1">); </span><span class="hl-7">// ID of the worker</span><br/><span class="hl-1">        </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">ipc</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">serviceName</span><span class="hl-1">); </span><span class="hl-7">// The name of the service</span><br/><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-7">// This is the function which will handle commands</span><br/><span class="hl-1">    </span><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-3">handleCommand</span><span class="hl-1">(</span><span class="hl-5">dataSentInCommand</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Return a response if you want to respond</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-5">dataSentInCommand</span><span class="hl-1">.</span><span class="hl-5">smileyFace</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">shutdown</span><span class="hl-1">(</span><span class="hl-5">done</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Optional function to gracefully shutdown things if you need to.</span><br/><span class="hl-1">        </span><span class="hl-3">done</span><span class="hl-1">(); </span><span class="hl-7">// Use this function when you are done gracefully shutting down.</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code></pre>
<p><strong>Make sure your service file extends BaseServiceWorker!</strong>
This service will simply return a value within an object sent to it within the command message called &quot;smileyFace&quot;. Services can be used for much more than this though. To send a command to this service, you could use this:</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">reply</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">ipc</span><span class="hl-1">.</span><span class="hl-3">command</span><span class="hl-1">(</span><span class="hl-4">&quot;myService&quot;</span><span class="hl-1">, {</span><span class="hl-5">smileyFace:</span><span class="hl-1"> </span><span class="hl-4">&quot;:)&quot;</span><span class="hl-1">}, </span><span class="hl-0">true</span><span class="hl-1">);</span><br/><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">bot</span><span class="hl-1">.</span><span class="hl-3">createMessage</span><span class="hl-1">(</span><span class="hl-5">msg</span><span class="hl-1">.</span><span class="hl-5">channel</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">, </span><span class="hl-5">reply</span><span class="hl-1">);</span>
</code></pre>
<p>This command is being sent using the IPC. In this command, the first argument is the name of the service to send the command to, the second argument is the message to send it (in this case a simple object), and the third argument is whether you want a response (this will default to false unless you specify &quot;true&quot;). If you want a response, you must <code>await</code> the command or use <code>.then()</code>.</p>

<a href="#handling-service-errors" id="handling-service-errors" style="color: inherit; text-decoration: none;">
  <h3>Handling service errors</h3>
</a>
<p>If you encounter an error while starting your service, run <code>this.serviceStartingError(&#39;error here&#39;)</code> instead of <code>this.serviceReady()</code>. Using this will report an error and restart the worker. <strong>Note that services always start before the clusters, so if your service keeps having starting errors your bot will be stuck in a loop.</strong> This issue may be fixed in the future from some sort of maxRestarts option, but this is currently not a functionality.</p>
<p>If you encounter an error when processing a command within your service, you can do the following to reject the promise:</p>
<pre><code class="language-js"><span class="hl-7">// handleCommand function within the ServiceWorker class</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-3">handleCommand</span><span class="hl-1">(</span><span class="hl-5">dataSentInCommand</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// Rejects the promise</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> {</span><span class="hl-5">err:</span><span class="hl-1"> </span><span class="hl-4">&quot;Uh oh.. an error!&quot;</span><span class="hl-1">};</span><br/><span class="hl-1">}</span>
</code></pre>
<p>When sending the command, you can do the following to deal with the error:</p>
<pre><code class="language-js"><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">ipc</span><span class="hl-1">.</span><span class="hl-3">command</span><span class="hl-1">(</span><span class="hl-4">&quot;myService&quot;</span><span class="hl-1">, {</span><span class="hl-5">smileyFace:</span><span class="hl-1"> </span><span class="hl-4">&quot;:)&quot;</span><span class="hl-1">}, </span><span class="hl-0">true</span><span class="hl-1">).</span><span class="hl-3">then</span><span class="hl-1">((</span><span class="hl-5">reply</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// A successful response</span><br/><span class="hl-1">    </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">bot</span><span class="hl-1">.</span><span class="hl-3">createMessage</span><span class="hl-1">(</span><span class="hl-5">msg</span><span class="hl-1">.</span><span class="hl-5">channel</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">, </span><span class="hl-5">reply</span><span class="hl-1">);</span><br/><span class="hl-1">}).</span><span class="hl-3">catch</span><span class="hl-1">((</span><span class="hl-5">e</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Do whatever you want with the error</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-3">error</span><span class="hl-1">(</span><span class="hl-5">e</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#in-depth" id="in-depth" style="color: inherit; text-decoration: none;">
  <h1>In-depth</h1>
</a>
<p>Below is more in-depth documentation.</p>

<a href="#admiral" id="admiral" style="color: inherit; text-decoration: none;">
  <h2>Admiral</h2>
</a>

<a href="#admiral-options" id="admiral-options" style="color: inherit; text-decoration: none;">
  <h3>Admiral options</h3>
</a>
<p>Visit <a href="https://danclay.github.io/eris-fleet/interfaces/Options.html">the docs</a> for a complete list of options.</p>

<a href="#admiral-events" id="admiral-events" style="color: inherit; text-decoration: none;">
  <h3>Admiral events</h3>
</a>
<p>Visit <a href="https://danclay.github.io/eris-fleet/classes/Fleet.html">the docs</a> for a complete list of events.</p>

<a href="#central-request-handler" id="central-request-handler" style="color: inherit; text-decoration: none;">
  <h3>Central Request Handler</h3>
</a>
<p>The central request handler forwards Eris requests to the master process where the request is sent to a single Eris request handler instance. This helps to prevent 429 errors from occurring when you have x number of clusters keeping track of ratelimiting separately. When a response is received, it is sent back to the cluster&#39;s Eris client.</p>

<a href="#large-bots" id="large-bots" style="color: inherit; text-decoration: none;">
  <h3>Large Bots</h3>
</a>
<p>If you are using a &quot;very large bot,&quot; Discord&#39;s special gateway settings apply. Ensure your shard count is a multiple of the number set by Discord or set <code>options.shards</code> and <code>options.guildsPerShard</code> to <code>&quot;auto&quot;</code>. You may also be able to use concurrency (see below).</p>

<a href="#concurrency" id="concurrency" style="color: inherit; text-decoration: none;">
  <h3>Concurrency</h3>
</a>
<p>Eris-fleet supports concurrency by starting clusters at the same time based on your bot&#39;s <code>max_concurrency</code> value. The clusters are started together in groups. The <code>max_concurrency</code> value can be overridden with <a href="https://danclay.github.io/eris-fleet/interfaces/Options.html#maxConcurrencyOverride">options.maxConcurrencyOverride</a></p>

<a href="#formats" id="formats" style="color: inherit; text-decoration: none;">
  <h3>Formats</h3>
</a>
<p>Visit <a href="https://danclay.github.io/eris-fleet/modules.html">the docs</a> to view the Typescript interfaces.</p>

<a href="#choose-what-to-log" id="choose-what-to-log" style="color: inherit; text-decoration: none;">
  <h3>Choose what to log</h3>
</a>
<p>You can choose what to log by using the <code>whatToLog</code> property in the options object. You can choose either a whitelist or a blacklist of what to log. You can select what to log by using an array. To possible array elements are shown <a href="https://danclay.github.io/eris-fleet/modules.html#LoggingOptions">on the docs</a>. Here is an example of choosing what to log:</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">options</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-7">// Your other options</span><br/><span class="hl-1">    </span><span class="hl-5">whatToLog:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">// This will only log when the admiral starts, when clusters are ready, and when services are ready.</span><br/><span class="hl-1">        </span><span class="hl-5">whitelist:</span><span class="hl-1"> [</span><span class="hl-4">&#39;admiral_start&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;cluster_ready&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;service_ready&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">};</span>
</code></pre>
<p>Change <code>whitelist</code> to <code>blacklist</code> if you want to use a blacklist. Change the array as you wish. <strong>Errors and warnings will always be sent.</strong></p>

<a href="#ipc" id="ipc" style="color: inherit; text-decoration: none;">
  <h2>IPC</h2>
</a>
<p>Clusters and services can use IPC to interact with other clusters, the Admiral, and services. Visit <a href="https://danclay.github.io/eris-fleet/classes/IPC.html">the IPC docs</a> to view available methods.</p>

<a href="#stats" id="stats" style="color: inherit; text-decoration: none;">
  <h2>Stats</h2>
</a>
<p>Stats are given in <a href="https://danclay.github.io/eris-fleet/interfaces/Stats.html">this</a> format.</p>

<a href="#using-a-specific-version-of-eris-or-a-modified-version-of-eris" id="using-a-specific-version-of-eris-or-a-modified-version-of-eris" style="color: inherit; text-decoration: none;">
  <h2>Using a specific version of Eris or a modified version of Eris</h2>
</a>
<p>You can use an extended Eris client by passing it to the Options. (see the <a href="https://danclay.github.io/eris-fleet/interfaces/Options.html#customClient">options.customClient</a> section).</p>
<p>Eris-fleet is able to use packages such as eris-additions if you desire. To do so, modify your bot file to match the following template:</p>
<pre><code class="language-js"><span class="hl-7">// Example using eris-additions</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">Fleet</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;eris-fleet&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">Eris</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;eris-additions&quot;</span><span class="hl-1">)(</span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;eris&quot;</span><span class="hl-1">));</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">options</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-7">// other options</span><br/><span class="hl-1">    </span><span class="hl-5">customClient:</span><span class="hl-1"> </span><span class="hl-5">Eris</span><br/><span class="hl-1">}</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">Admiral</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Fleet</span><span class="hl-1">(</span><span class="hl-5">options</span><span class="hl-1">);</span>
</code></pre>

<a href="#using-es-modules" id="using-es-modules" style="color: inherit; text-decoration: none;">
  <h2>Using ES Modules</h2>
</a>
<p>Instead of using the file path, you can use ES Modules by passing your BotWorker class to <code>options.BotWorker</code> and your ServiceWorker class to <code>ServiceWorker</code> in the <code>options.services</code> array. See <a href="https://github.com/danclay/eris-fleet/tree/master/test">test/</a> for examples.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/BaseClusterWorker.html" class="tsd-kind-icon">Base<wbr/>Cluster<wbr/>Worker</a></li><li class="tsd-kind-class"><a href="classes/BaseServiceWorker.html" class="tsd-kind-icon">Base<wbr/>Service<wbr/>Worker</a></li><li class="tsd-kind-class"><a href="classes/CentralStore.html" class="tsd-kind-icon">Central<wbr/>Store</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/Collection.html" class="tsd-kind-icon">Collection</a></li><li class="tsd-kind-class"><a href="classes/Fleet.html" class="tsd-kind-icon">Fleet</a></li><li class="tsd-kind-class"><a href="classes/IPC.html" class="tsd-kind-icon">IPC</a></li><li class="tsd-kind-interface"><a href="interfaces/ClusterCollection.html" class="tsd-kind-icon">Cluster<wbr/>Collection</a></li><li class="tsd-kind-interface"><a href="interfaces/ClusterStats.html" class="tsd-kind-icon">Cluster<wbr/>Stats</a></li><li class="tsd-kind-interface"><a href="interfaces/ObjectLog.html" class="tsd-kind-icon">Object<wbr/>Log</a></li><li class="tsd-kind-interface"><a href="interfaces/Options.html" class="tsd-kind-icon">Options</a></li><li class="tsd-kind-interface"><a href="interfaces/ReshardOptions.html" class="tsd-kind-icon">Reshard<wbr/>Options</a></li><li class="tsd-kind-interface"><a href="interfaces/ServiceCollection.html" class="tsd-kind-icon">Service<wbr/>Collection</a></li><li class="tsd-kind-interface"><a href="interfaces/ServiceCreator.html" class="tsd-kind-icon">Service<wbr/>Creator</a></li><li class="tsd-kind-interface"><a href="interfaces/ServiceStats.html" class="tsd-kind-icon">Service<wbr/>Stats</a></li><li class="tsd-kind-interface"><a href="interfaces/ShardStats.html" class="tsd-kind-icon">Shard<wbr/>Stats</a></li><li class="tsd-kind-interface"><a href="interfaces/ShardUpdate.html" class="tsd-kind-icon">Shard<wbr/>Update</a></li><li class="tsd-kind-interface"><a href="interfaces/StartingStatus.html" class="tsd-kind-icon">Starting<wbr/>Status</a></li><li class="tsd-kind-interface"><a href="interfaces/Stats.html" class="tsd-kind-icon">Stats</a></li><li class="tsd-kind-type-alias"><a href="modules.html#LoggingOptions" class="tsd-kind-icon">Logging<wbr/>Options</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>